name: Notify Insider Flow

on:
  schedule:
    - cron: '0 12 * * *'
  workflow_dispatch:

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install deps
        run: pip install requests

      - name: Send Telegram
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          python -c "
import json, os, requests
with open('insider_flow.json') as f:
  data = json.load(f)
bias = 'Neutral Bias ðŸ‘€'
if data['total_buys'] > data['total_sells']: bias = 'Buy-Side Bias ðŸ‘€'
elif data['total_sells'] > data['total_buys']: bias = 'Sell-Side Bias ðŸ‘€'
msg = f'''
ðŸ“Š Insider Flow Summary

ðŸ’° Top Buys: ${data['total_buys']:,}
ðŸ’¥ Top Sells: ${data['total_sells']:,}

ðŸ§® Total Buys: ${data['total_buys']:,} | Total Sells: ${data['total_sells']:,}
ðŸ“‰ Bias: {bias}
'''
url = f'https://api.telegram.org/bot{os.getenv('TELEGRAM_BOT_TOKEN')}/sendMessage'
requests.post(url, json={'chat_id': os.getenv('TELEGRAM_CHAT_ID'), 'text': msg})
print('âœ… Telegram sent!')
"